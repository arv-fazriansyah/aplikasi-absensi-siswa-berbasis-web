<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Absensi Siswa - __NAMA_SEKOLAH__</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 20px auto; padding: 10px; }
    header { text-align: center; margin-bottom: 20px; }
    select, button { width: 100%; padding: 8px; margin: 5px 0; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 5px; text-align: center; }
    .submit { background: green; color: white; }
  </style>
</head>
<body>
  <header>
    <h2>Absensi - __NAMA_SEKOLAH__</h2>
    <small>NPSN: __NPSN__ | Tahun Ajaran: __TAHUN_AJARAN__</small>
  </header>

  <label>Kelas:</label>
  <select id="kelas">__KELAS_OPTIONS__</select>

  <label>Role:</label>
  <select id="role">__ROLE_OPTIONS__</select>

  <table id="tabel">
    <thead><tr><th>Nama</th><th>Status</th></tr></thead>
    <tbody></tbody>
  </table>

  <button class="submit" id="kirim">Kirim Absensi</button>

<script>
const token = "__TOKEN__";
const tabel = document.querySelector("#tabel tbody");
const kelasSelect = document.querySelector("#kelas");
const roleSelect = document.querySelector("#role");

async function loadSiswa() {
  const res = await fetch(`?token=${token}&kelas=${kelasSelect.value}`);
  const data = await res.json();
  tabel.innerHTML = data.map(s => 
    `<tr><td>${s.NAMA}</td>
    <td><select>
      <option>Hadir</option><option>Sakit</option>
      <option>Izin</option><option>Alpa</option>
    </select></td></tr>`
  ).join("");
}

kelasSelect.onchange = loadSiswa;
loadSiswa();

document.querySelector("#kirim").onclick = async () => {
  const absensi = [...tabel.querySelectorAll("tr")].map(tr => ({
    token, 
    kelas: kelasSelect.value,
    role: roleSelect.value,
    nama: tr.cells[0].textContent,
    status: tr.cells[1].querySelector("select").value
  }));

  await fetch("", { method: "POST", body: JSON.stringify(absensi) });
  alert("Absensi terkirim!");
};
</script>
</body>
</html>
